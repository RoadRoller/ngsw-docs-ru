---
sidebar_position: 7
sidebar_label: Выявление и аннотация соматических SNVs/Indels
---

# Выявление и аннотация соматических SNVs/Indels

## Выявление соматических SNVs/Indels {#somatic-variants-discovery}

После успешного выполнения
стадии ["Предварительная обработка для выявления вариантов"](/results/workflow-details/fastq-analysis/variant-discovery-preprocessing)
для образцов опухолевой ткани
может запуститься выявление соматических SNVs/Indels, если
стадия [включена](/settings/settings/variant-discovery-settings#somatic-snvs-discovery) в анализ.

<p align="center">
<img src={require('/img/rus/somatic_pipeline.png').default} width="750"/>
</p>

### 1. Выявление соматических SNVs/Indels {#1-somatic-variants-discovery}

Выявление соматических однонуклеотидных вариантов
(single-nucleotide variants; SNVs) и коротких инсерций/делеций (indels) происходит с помощью
инструмента [GATK Mutect2](https://gatk.broadinstitute.org/hc/en-us/articles/360037593851-Mutect2).

#### I. Разделение данных на интервалы {#intervals}

Для ускорения процесса и сохранения ресурсов используется операция Scatter-Gather, которая делит входные данные
на 64 геномных интервала.
При этом, если известен capture kit образца, то данные разделяются с помощью
[bedtools intersect](https://bedtools.readthedocs.io/en/latest/content/tools/intersect.html), который
выявляет области, пересекающиеся между отдельными геномными интервалами и
интервалами набора capture kit.

#### II. Поиск вариантов {#calling}

В каждом из получившихся интервалов происходит поиск вариантов с
помощью [GATK Mutect2](https://gatk.broadinstitute.org/hc/en-us/articles/360037593851-Mutect2).
Mutect2 работает в первую очередь путем сопоставления вариантов в опухоли и контроле (режим tumor-normal).
В этом случае он включает в себя логику для исключения
вариантов, которые явно присутствуют в клетках зародышевой линии на основании предоставленных доказательств
в соответствующем контрольном образце. Это делается на ранней стадии, чтобы не тратить вычислительные
ресурсы на герминальные варианты. Если герминальное происхождение варианта пограничное, то Mutect2 отправит
вариант на
последующую [фильтрацию и проверку с помощью FilterMutectCalls](/results/workflow-details/fastq-analysis/somatic_snvs_indels#filter-mutect-calls).
Помимо этого, Mutect2 также подходит и для поиска вариантов в опухоли без контроля (режим tumor-only), но такой поиск
отличается высоким уровнем ложных срабатываний (false positives).

Для работы Mutect2 рекомендуется использование нормальной панели (Panel of Normal; PON) - панели,
полученной из образцов здоровой ткани (то есть ткани, не имеющей
соматических мутаций) для захвата повторяющихся технических артефактов с целью улучшения результатов
выявления соматических вариантов. При этом образцы здоровой ткани, на которых строится
панель, должны быть получены с помощью секвенирования со схожими техническими характеристиками, такими как тип
секвенирования, секвенатор, реагент Capture Kit и т.д. Таким образом, при выборе PON, подходящей для ваших данных,
необходимо руководствоваться техническими характеристиками секвенирования образца опухолевой ткани. Чем
точнее подобрана панель, тем более специфичным становится анализ и может быть выявлено больше вариантов.
По умолчанию анализ проводится с панелью "*Basic panel of normals*".
Чтобы выбрать другую панель или провести анализ без нормальной панели,
выберите [соответствующую опцию](/settings/settings/variant-discovery-settings#panel-of-normal) в параметрах.

В качестве источника частот аллелей распространённых
и редких вариантов используется база [gnomAD](https://gnomad.broadinstitute.org/news/2020-10-gnomad-v3-1/).

По умолчанию при поиске вариантов учитываются мягко отсекаемые основания (soft clipped bases), т.е.
основания, находящиеся на концах секвенирования последовательности и не совпадающие с референсной последовательностью.
Это регулируется [соответствующей настройкой](/settings/settings/variant-discovery-settings#soft-clipped-bases).

Для устранения возможных ошибок замены, возникающих в одной цепи перед секвенированием, применяется
фильтр смещения ориентации. Фильтр состоит из трёх этапов. В работу Mutect2 включён первый этап фильтрации:
сбор метрик F1R2 (F1R2 - пара прочтений, у которой
последовательность оснований в первом прочтении сопоставляется с прямой цепью референса, а последовательность
второго прочтения - с комплементарной цепью референса).

#### III. Объединение выявленных вариантов {#merge-vcfs}

С помощью [GATK MergeVcfs](https://gatk.broadinstitute.org/hc/en-us/articles/360036713331-MergeVcfs-Picard) проводится
объединение файлов с вариантами, выявленными в отдельных геномных интервалах, в один файл в формате VCF со всеми
соматическими вариантами, выявленными в образце.
Получившийся файл сжимается в GZIP архив с
помощью [bgzip](http://www.htslib.org/doc/bgzip.html).
Его можно скачать в разделе "*Файлы с результатами*" в деталях
задачи "*Выявление соматических SNVs/Indels*" ("*Скачать VCF_GZ*"). Также этот файл можно открыть в IGV, нажав
на ссылку "*Открыть в IGV браузере*".
Кроме того, VCF файл индексируется с помощью [tabix](http://www.htslib.org/doc/tabix.html).
Получившийся индексный файл можно скачать в том же разделе ("*Скачать VCF_TBI*").

#### IV. Объединение статистики {#merge-mutect-stats}

[GATK MergeMutectStats](https://gatk.broadinstitute.org/hc/en-us/articles/360035531132--How-to-Call-somatic-mutations-using-GATK4-Mutect2)
объединяет файлы статистики, полученные на разделённых ранее интервалах.
Получившийся файл в формате TSV можно скачать в
разделе "*Файлы с результатами*" в деталях задачи "*Выявление соматических SNVs/Indels*"
("*Скачать Mutect2 stats TSV*"). Также этот файл можно открыть в таблицах Google.

#### V. Построение модели ориентации прочтения {#learn-read-orientation-model}

Вторым этапом фильтрации смещения ориентации является
работа [GATK LearnReadOrientationModel](https://gatk.broadinstitute.org/hc/en-us/articles/360051305331-LearnReadOrientationModel).
Он рассчитывает оценку максимального правдоподобия априорных вероятностей артефактов смещения ориентации прочтения.
В результате генерируется таблица предшествующих артефактов для каждого образца опухоли. Полученный файл
с моделью ориентации прочтения в формате tar.gz можно скачать в разделе "*Файлы с результатами*" в деталях
задачи "*Выявление соматических SNVs/Indels*" ("*Скачать Read orientation model TAR_GZ*").

### 2. Фильтрация сырых SNVs/Indels {#filter-row-variants}

#### I. Создание таблицы метрик Pileup {#get-pileup-summaries}

[GATK GetPileupSummaries](https://gatk.broadinstitute.org/hc/en-us/articles/360037593451-GetPileupSummaries)
создаёт таблицу с метриками формата Pileup, помогающими сделать вывод о контаминации.
Для этого он суммирует количество прочтений, поддерживающих референсный, альтернативный и другие аллели данных вариантов.
Получившуюся таблицу в формате TXT можно скачать в разделе "*Файлы с результатами*" в деталях
задачи "*Фильтрация сырых SNVs/Indels*" ("*Скачать Pileup table TXT*").

#### II. Создание таблицы контаминации {#calculate-contamination}

На основе данных, полученных GetPileupSummaries
на [предыдущем этапе](/results/workflow-details/fastq-analysis/somatic_snvs_indels#get-pileup-summaries),
[GATK CalculateContamination](https://gatk.broadinstitute.org/hc/en-us/articles/360036888972-CalculateContamination)
рассчитывает долю прочтений, полученных в результате перекрёстного загрязнения образцов.
В полученной таблице контаминации указывается загрязненность каждого проанализированного образца.
Таблицу можно скачать в разделе "*Файлы с результатами*" в деталях
задачи "*Фильтрация сырых SNVs/Indels*" ("*Скачать Contamination table TXT*").

#### III. Фильтрация вариантов {#filter-mutect-calls}

[GATK FilterMutectCalls](https://gatk.broadinstitute.org/hc/en-us/articles/360036856831-FilterMutectCalls)
фильтрует соматические SNVs/Indels, выявленные Mutect2. Для этого он использует:
- таблицу, содержащую информацию о контаминации,
созданную на [предыдущем этапе](/results/workflow-details/fastq-analysis/somatic_snvs_indels#calculate-contamination);
- файл статистики, выводимой Mutect2, полученный
на [этапе объединения статистики](/results/workflow-details/fastq-analysis/somatic_snvs_indels#merge-mutect-stats);
- файл, содержащий таблицу априорных вероятностей артефактов, полученный
на [этапе построения модели ориентации прочтения](/results/workflow-details/fastq-analysis/somatic_snvs_indels#learn-read-orientation-model).

Получившийся файл сжимается в GZIP архив с
помощью [bgzip](http://www.htslib.org/doc/bgzip.html).
Его можно скачать в разделе "*Файлы с результатами*" в деталях
задачи "*Фильтрация сырых SNVs/Indels*" ("*Скачать VCF_GZ*"). Также этот файл можно открыть в IGV, нажав
на ссылку "*Открыть в IGV браузере*".
Кроме того, VCF файл индексируется с помощью [tabix](http://www.htslib.org/doc/tabix.html).
Получившийся индексный файл можно скачать в том же разделе ("*Скачать VCF_TBI*").

## Аннотация соматических SNVs/Indels {#annotate-variants}

После успешного выполнения
стадии ["Выявление соматических SNVs/Indels"](/results/workflow-details/fastq-analysis/somatic_snvs_indels#somatic-variants-discovery)
осуществляется аннотация выявленных соматических вариантов.

### 1. Аннотация соматических SNVs/Indels {#1-annotate-variants}

- Аннотация SNVs/Indels в файле данными из баз [RefSeq](https://www.ncbi.nlm.nih.gov/refseq/),
[1000 Genomes](https://www.internationalgenome.org/), [dbNSFP](https://sites.google.com/site/jpopgen/dbNSFP),
[dbSNP](https://www.ncbi.nlm.nih.gov/snp/), [gnomAD 3](https://gnomad.broadinstitute.org/news/2020-10-gnomad-v3-1/),
[gnomAD 4](https://gnomad.broadinstitute.org/),
[ClinVar](https://preview.ncbi.nlm.nih.gov/clinvar/), [CADD](https://cadd.gs.washington.edu/),
[SpliceAI](https://spliceailookup.broadinstitute.org/), [ENIGMA](https://enigmaconsortium.org/).
- Определение влияния SNVs/Indels на гены, транскрипты, белковые последовательности и регуляторные
области с помощью [Ensembl Variant Effect Predictor (VEP)](https://www.ensembl.org/info/docs/tools/vep/index.html),
используя
алгоритм предсказания [PolyPhen](http://genetics.bwh.harvard.edu/pph2/) (результатом предсказания
для вариантов являются prediction и score) и [номенклатуру HGVS](https://varnomen.hgvs.org/).
В процессе также определяются канонический транскрипт гена,
номер аллеля из входных данных и номера затронутых вариантами экзонов и интронов. Невариантные строки
(где ALT пустой) остаются в итоговом файле.
Варианты определяются как upstream, если они расположены перед геном и расстояние между вариантом
и транскриптом больше 2000 п.о., и downstream, если варианты расположены после гена и расстояние между
вариантом и транскриптом больше 1000 п.о.<br></br>
Получившийся файл с сырыми аннотированными вариантами в формате TSV можно скачать в
разделе "*Файлы с результатами*" в деталях задачи "*Аннотация соматических SNVs/Indels*"
("*Скачать Raw annotated TSV*").
Его также можно открыть в таблицах Google.<br></br>
Получившийся файл с аннотированными вариантами без дубликатов в формате TSV можно скачать в
том же разделе ("*Скачать All variants TSV*").
Его также можно открыть в таблицах Google.
Тот же файл, но в формате CSV можно скачать там же ("*Скачать All variants CSV*").
- Конвертация результатов в формате TSV в формат VCF.
- Замена или исправление заголовка файла VCF
с помощью [GATK FixVCFHeader](https://gatk.broadinstitute.org/hc/en-us/articles/360037428851-FixVcfHeader-Picard-).
- Сжатие файла VCF в GZIP архив с помощью [bgzip](http://www.htslib.org/doc/bgzip.html).
Получившийся файл можно скачать в разделе "*Файлы с результатами*" в деталях задачи
"*Аннотация соматических SNVs/Indels*"
("*Скачать All variants VCF_GZ*"). Также этот файл можно открыть в IGV, нажав на ссылку "*Открыть в IGV браузере*".
- Индексация файла VCF с помощью [tabix](http://www.htslib.org/doc/tabix.html).
Получившийся индексный файл можно скачать в том же разделе ("*Скачать All variants VCF_TBI*").
- Вычисление статистики вариантов.

### 2. Сохранение проаннотированных вариантов для SNV Viewer {#save-variants}

Сохранение результатов для показа во встроенном модуле для просмотра и анализа
вариантов [SNV Viewer](/results/main/snvs-indels/variant-viewer) и
добавление информации о [встречаемости](/results/main/snvs-indels/snv-details-page#occurrences) варианта в
других образцах пользователя.

После стадии "Аннотация соматических SNVs/Indels" анализ может продолжиться генерацией отчётов.

:::info На заметку
Если вы хотите добавить в вашу [десктопную версию IGV](https://igv.org/doc/desktop/) трек с соматическими SNVs/Indels,
выявленными в результате анализа вашего образца в Genomenal, вы можете сделать это через ссылку.
Откройте детали нужной задачи ("*Выявление соматических SNVs/Indels*", "*Фильтрация сырых SNVs/Indels*",
"*Аннотация соматических SNVs/Indels*") и сделайте следующее:
1. Нажмите правой кнопкой мыши на ссылку файла с вариантами (в зависимости от выбранной задачи это может быть ссылка
"*Скачать VCF_GZ*", "*Скачать All variants VCF_GZ*" или "*Скачать Filtered variants VCF_GZ*")
и выберите опцию "*Копировать адрес ссылки*".
2. Загрузите трек через URL в вашу десктопную версию IGV, как это
описано [здесь](https://igv.org/doc/desktop/#UserGuide/loading_data/).
3. Нажмите правой кнопкой мыши на ссылку для скачивания индексного файла, соответствующего файлу аннотации,
("*Скачать VCF_TBI*", "*Скачать All variants VCF_TBI*" или "*Скачать Filtered variants VCF_TBI*") и
выберите опцию "*Копировать адрес ссылки*".
4. Добавьте URL индексного файла в соответствующее поле в IGV.
5. Нажмите "*OK*". Готово! Трек с соматическими SNVs/Indels, выявленными в образце, добавлен в IGV.
:::
