---
sidebar_position: 5
sidebar_label: Предварительная обработка для выявления вариантов
---

# Предварительная обработка для выявления вариантов

После успешного выполнения задачи
"Выравнивание", входящей в [одноименную стадию](/results/workflow-details/fastq-analysis/alignment), для
наиболее точного выявления вариантов результаты выравнивания рекомендуется дополнительно
обработать. Это повышает чувствительность к низкочастотным вариантам, способствует более точному
подсчету количества копий, который зависит от количества прочтений, а также ускоряет обработку образца.
Предварительная обработка для выявления вариантов запускается, если хотя бы одна из следующих
стадий включена в анализ образца:
["Выявление соматических SNVs/Indels"](/settings/settings/variant-discovery-settings#somatic-snvs-discovery)
(для образца опухолевой ткани),
["Выявление герминальных SNVs/Indels"](/settings/settings/variant-discovery-settings#germline-snvs-discovery),
["Выявление структурных вариаций"](/settings/settings/variant-discovery-settings#sv-discovery),
["Выявление вариации числа копий"](/settings/settings/variant-discovery-settings#cnv-discovery)
или ["Предсказание фенотипов"](/settings/settings/variant-discovery-settings#phenotype-prediction).
При ошибке выполнения любой из перечисленных ниже задач анализ образца останавливается.

<p align="center">
<img src={require('/img/rus/variant_discovery_preprocessing.png').default} width="850"/>
</p>

Стадия анализа образца "Предварительная обработка для выявления вариантов" может включать следующие задачи:
1. **Пометка дубликатов**, если для образца
включен [соответствующий параметр](/settings/settings/variant-discovery-settings#disable-mark-duplicates).
В процессе секвенирования количество оригинальных последовательностей фрагментированной ДНК увеличивается
в полимеразной цепной реакции (ПЦР). Для дальнейшего анализа очень важно учесть дублирующиеся
прочтения одного и того же фрагмента. Если вы хотите сохранить все прочтения для дальнейшего анализа
(например, если вы работаете с ампликонами), то вы
можете [отключить пометку дубликатов](/settings/settings/variant-discovery-settings#disable-mark-duplicates).<br></br>
Пометка дубликатов выполняется с помощью инструмента
[GATK MarkDuplicates](https://gatk.broadinstitute.org/hc/en-us/articles/360037052812-MarkDuplicates-Picard-),
который находит в файле выравнивания повторяющиеся прочтения, определяет, какие из прочтений происходят от
оригинальных последовательностей, а какие являются копиями (дубликатами), и помечает дубликаты.
Дальнейший анализ ведется только по оригинальным прочтениям. Итоговый файл в формате BAM
сортируется по координатам и для него создается индексный файл.
Кроме того, в ходе выполнения задачи создается файл с метриками, в котором указывается количество
дубликатов как для одиночных, так и для парных прочтений. Этот файл можно скачать в
разделе "*Файлы с результатами*" в деталях задачи "*Пометка дубликатов*" ("*Скачать duplication metrics TXT*").

2. **Рекалибровка качества нуклеотидов**.
Секвенатор присваивает каждому нуклеотиду качество, которое представляет собой логарифм вероятности того,
что при секвенировании этот нуклеотид был определен верно, но многие секвенаторы имеют тенденцию к недооценке 
качества секвенирования и к другим ошибкам. Рекалибровка качества нуклеотидов позволяет исправить
систематическое отклонение, влияющее на присвоение секвенатором качества нуклеотидам, что уменьшает ошибку
и улучшает качество выявления вариантов в дальнейшем.

Рекалибровка качества нуклеотидов (Base Quality Score Recalibration; BQSR) выполняется в три этапа:
- Эмпирический расчёт ошибки и поиск закономерностей того, как ошибка изменяется в зависимости от
особенностей определения нуклеотидов по всем нуклеотидам, с
помощью [GATK BaseRecalibrator](https://gatk.broadinstitute.org/hc/en-us/articles/360036898312-BaseRecalibrator).
Соответствующие наблюдения записываются в таблицу рекалибровки на основе таких ковариат, как группа прочтения,
заявленная оценка качества, машинный цикл и нуклеотидный контекст. Работает только в определенных интервалах
с известными полиморфными сайтами, которые
используются для исключения из анализа областей вокруг известных полиморфизмов. Все найденные несоответствия
с референсной последовательностью рассматриваются как ошибки и указывают на низкое качество нуклеотидов.
Затем вычисляется эмпирическая вероятность ошибки (p) с учётом конкретных ковариат, наблюдаемых в этом
сайте: p = количество несоответствий / количество наблюдений.
Выходной файл представляет собой таблицу, которая содержит несколько значений ковариат, количество
наблюдений, количество несоответствий и эмпирический показатель качества.
Таблицу рекалибровки можно скачать в разделе "*Файлы с результатами*" в деталях задачи
"*Рекалибровка качества нуклеотидов*" ("*Скачать recalibration table TXT*").
- Применение числовых поправок к каждому отдельному определению нуклеотида (рекалибровка качества нуклеотидов
прочтений образца) в пределах определенных интервалов на основе закономерностей, выявленных на первом этапе
и записанных в таблице рекалибровки, и запись рекалиброванных данных в новый файл в формате BAM с помощью
[GATK ApplyBQSR](https://gatk.broadinstitute.org/hc/en-us/articles/360037055712-ApplyBQSR).
- Объединение файлов BAM с результатами рекалибровки в пределах определенных интервалов в один с
помощью [GATK MergeSamFiles](https://gatk.broadinstitute.org/hc/en-us/articles/360037053552-MergeSamFiles-Picard-).
Итоговый файл в формате BAM сортируется по координатам и для него создается индексный файл.

Итоговый файл выравнивания образца после предварительной обработки можно скачать в
разделе "*Файлы с результатами*" в деталях задачи "*Рекалибровка качества нуклеотидов*" ("*Скачать BAM*").
Также этот файл можно открыть в IGV, нажав на ссылку "*Открыть в IGV браузере*".
Индексный файл к итоговому файлу BAM можно скачать там же ("*Скачать BAI*").

:::info На заметку
Если вы хотите добавить в вашу [десктопную версию IGV](https://igv.org/doc/desktop/) трек выравнивания образца
после предварительной обработки, полученного с помощью Genomenal, вы можете сделать это через ссылку. Для этого
сделайте следующее:
1. Нажмите правой кнопкой мыши на ссылку на файл выравнивания "*Скачать BAM*"
и выберите опцию "*Копировать адрес ссылки*".
2. Загрузите трек через URL в вашу десктопную версию IGV, как это
описано [здесь](https://igv.org/doc/desktop/#UserGuide/loading_data/).
3. Нажмите правой кнопкой мыши на ссылку на индексный файл выравнивания "*Скачать BAI*"
и выберите опцию "*Копировать адрес ссылки*".
4. Добавьте URL индексного файла в соответствующее поле в IGV.
5. Нажмите "*OK*". Готово! Трек выравнивания образца после предварительной обработки добавлен в IGV.
:::

После успешного выполнения стадии "Предварительная обработка для выявления вариантов" анализ
продолжается [вычислением покрытия](/results/workflow-details/fastq-analysis/calculate-coverage),
а также следующими стадиями, если они включены в
анализ: ["Выявление соматических SNVs/Indels"](/results/workflow-details/fastq-analysis/somatic-snvs-indels#somatic-variants-discovery)
(для образца опухолевой ткани),
["Выявление герминальных SNVs/Indels"](/results/workflow-details/fastq-analysis/germline-snvs-indels#germline-variants-discovery)
(для одиночного образца опухолевой ткани или
образца неопухолевой
ткани), ["Выявление структурных вариаций"](/results/workflow-details/fastq-analysis/structural-variations),
["Выявление вариации числа копий"](/results/workflow-details/fastq-analysis/cnv-discovery)
и/или "Предсказание фенотипов" (для образца неопухолевой ткани).
