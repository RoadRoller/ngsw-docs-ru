---
sidebar_position: 5
sidebar_label: Пользовательские аннотации
---

# Пользовательские аннотации

Если вы хотите проаннотировать найденные варианты с использованием дополнительных данных, 
загрузите пользовательскую аннотацию, содержащую эти данные. В том числе, можно добавить в систему
аннотации, содержащие данные о патогенности вариантов, и аннотацию из базы COSMIC.

Чтобы открыть раздел с пользовательскими аннотациями, перейдите на страницу "**Пользовательские аннотации**" из блока
страниц "Настройки" через панель навигации слева:

<p align="center">
<img src={require('/img/custom-annot/custom_annot_page.png').default} width="900"/>
</p>

## Добавление пользовательской аннотации {#add-custom-annotation}

Для перехода к форме добавления пользовательской аннотации
нажмите на <img src={require('/img/custom-annot/upload_btn.png').default} width="170"/>.
На открывшейся странице можно задать имя и ввести описание загружаемой аннотации, нажав на "**-**"
(по умолчанию именем аннотации станет название файла):

<p align="center">
<img src={require('/img/custom-annot/name.png').default} height="170"/>
</p>

### 1. Загрузка файла {#upload-file}

Загрузите файл аннотации в формате **VCF**, **CSV** или **TSV**.
Для этого перетащите файл в окно или нажмите на него, чтобы открыть диспетчер файлов:

<p align="center">
<img src={require('/img/custom-annot/uploading_window.png').default} width="450"/>
</p>

Укажите сборку референса аннотации (hg19 или hg38) для правильного аннотирования вариантов:

<p align="center">
<img src={require('/img/custom-annot/genome.png').default} width="330"/>
</p>

Сразу после загрузки вам будет доступен предпросмотр первых семи строк аннотации.

### 2. Определение типа пользовательской аннотации {#define-annotation-type}

Для загрузки доступны пользовательские аннотации следующих типов:
1. **База патогенности** - аннотация, которая содержит колонку с классами патогенности вариантов.
Для колонки поддерживаются следующие числовые или текстовые значения:
- "1" или "Benign" = доброкачественный вариант;
- "2" или "Likely_benign" = вероятно доброкачественный вариант;
- "3" или "Uncertain_significance" = вариант неопределенной значимости;
- "4" или "Likely_pathogenic" = вероятно патогенный вариант;
- "5" или "Pathogenic" = патогенный вариант.

Если в загруженной аннотации есть колонка с подобными значениями, система предложит вам определить эту аннотацию
как базу патогенности. Чтобы это сделать, нажмите на переключатель:

<p align="center">
<img src={require('/img/custom-annot/pathogenicity_def.png').default} width="500"/>
</p>

Результат аннотации вариантов образца по базе патогенности будет
представлен [в колонке "Патогенность" в Variant Viewer](/results/main/snvs-indels/pathogenicity#define-pathogenicity-by-base).

:::info На заметку
В качестве базы патогенности можно определить сколько угодно пользовательских аннотаций - все они будут
использоваться при аннотации, если не пересекаются по вариантам.
Если вариант есть в нескольких базах патогенности, то он будет аннотироваться той из них, которая была
загружена последней.
:::

2. **База COSMIC** - аннотация в формате VCF, которая содержит колонку с идентификаторами вариантов из
базы [COSMIC](https://cancer.sanger.ac.uk/cosmic/) (COSV\*\*\*\*\*\*\*\*\).
Если в загруженной аннотации есть колонка с подобными значениями, система предложит вам определить эту аннотацию
как базу COSMIC. Чтобы это сделать, нажмите на переключатель:

<p align="center">
<img src={require('/img/custom-annot/cosmic_def.png').default} width="500"/>
</p>

Результат аннотации вариантов образца по базе COSMIC будет представлен
в [колонке "Внешние ссылки" в Variant Viewer](/results/main/snvs-indels/variant-viewer#columns-description): <img src={require('/img/vv/cosmic.png').default} width="35"/>.

:::info На заметку
Только одна пользовательская аннотация может быть определена как база COSMIC.
При определении новой аннотации как базы COSMIC определение предыдущей базы удаляется.
:::

3. **База частот** - аннотация в формате TSV или CSV, которая содержит колонку "Samples_with_SNP" с количеством
образцов, в которых был обнаружен вариант, и колонку "Number_of_samples" с общим количеством исследованных образцов
(значения обеих колонок - натруальные числа).
Если в загруженной аннотации есть колонки с подобными значениями, система предложит вам определить эту аннотацию
как базу частот. Чтобы это сделать, нажмите на переключатель:

<p align="center">
<img src={require('/img/custom-annot/frequencies_base.png').default} width="600"/>
</p>

Результат аннотации вариантов образца по базе частот будет использоваться при расчёте
значения достоверности выявления варианта при
построении [отчёта на основе данных ClinVar с рекомендациями](/results/variants-by-phenotypes).

:::info На заметку
Только одна пользовательская аннотация может быть определена как база частот.
При определении новой аннотации как базы частот определение предыдущей базы удаляется.
:::

4. **Аннотация с любой другой информацией о варианте** - в этом случае тип аннотации определять не нужно.

### 3. Сопоставление колонок {#map-columns}

Если вы загрузили файл аннотации ***в формате VCF***, то колонки, необходимые для аннотации,
(CHROM, POS, REF, ALT) определятся ***автоматически***.

Если вы загрузили файл аннотации ***в формате CSV или TSV***, то нужно ***определить колонки***, 
необходимые для аннотации:

<p align="center">
<img src={require('/img/custom-annot/main_columns.png').default} width="950"/>
</p>

- CHROMOSOME - колонка с названиями хромосом, в которых расположены варианты.
- POSITION (1-BASED) - колонка со стартовыми позициями вариантов.
- REFERENCE - колонка с референсными аллелями вариантов.
- ALTERNATIVE - колонка с альтернативными аллелями вариантов.

Для каждой колонки выберите соответствующую колонку из загруженной вами аннотации.
Например, в данном случае колонке "CHROMOSOME" соответствует колонка "chr" из аннотации:

<p align="center">
<img src={require('/img/custom-annot/chromosome_column.png').default} width="300"/>
</p>

Если вы определили аннотацию как ***базу патогенности***, то для любого формата файла для аннотации
необходимо определить:
- колонку с названием гена:

<p align="center">
<img src={require('/img/custom-annot/gene_column.png').default} width="300"/>
</p>

- колонку с классами патогенности вариантов (убедитесь, что была выбрана верная колонка при автоматическом
определении):

<p align="center">
<img src={require('/img/custom-annot/pathogenicity_column.png').default} width="300"/>
</p>

Если вы определили аннотацию как ***базу COSMIC***, то для аннотации
необходимо определить колонку с идентификатором варианта из
базы [COSMIC](https://cancer.sanger.ac.uk/cosmic/) (COSV\*\*\*\*\*\*\*\*\) (убедитесь, что была выбрана верная
колонка при автоматическом определении):

<p align="center">
<img src={require('/img/custom-annot/id.png').default} width="300"/>
</p>

Если вы определили аннотацию как ***базу частот***, то для любого формата файла для аннотации
необходимо определить:
- колонку с количеством образцов, в которых был обнаружен вариант (убедитесь, что была выбрана верная колонка
при автоматическом определении):

<p align="center">
<img src={require('/img/custom-annot/samples_with_snp.png').default} width="300"/>
</p>

-  колонку с общим количеством исследованных образцов (убедитесь, что была выбрана верная колонка при
автоматическом определении):

<p align="center">
<img src={require('/img/custom-annot/number_of_samples.png').default} width="300"/>
</p>

### 4. Добавление колонки аннотации {#add-annotation-column}

- Недоступно, если вы определили аннотацию как *базу патогенности*.
- Доступно, но не обязательно к заполнению, если вы определили аннотацию как *базу COSMIC*.

В загруженной аннотации выберите колонки с данными, которыми вы хотите аннотировать варианты:

1. Нажмите на <img src={require('/img/custom-annot/add_new_column.png').default} width="250"/>.
2. В открывшемся окне задайте имя колонке:

<p align="center">
<img src={require('/img/custom-annot/column_name.png').default} height="400"/>
</p>

3. Укажите выбранную колонку в файле.
Скажем, у нас есть данные с частотами вариантов в экзоме и мы хотим аннотировать найденные
варианты с использованием этой информации. Для этого выберем соответствующую колонку в файле:

<p align="center">
<img src={require('/img/custom-annot/file_column.png').default} width="380"/>
</p>

4. Определите тип колонки: текстовый или числовой:

<p align="center">
<img src={require('/img/custom-annot/filed_type.png').default} width="400"/>
</p>

5. Нажмите <img src={require('/img/custom-annot/ok_btn.png').default} width="130"/>.

Колонка аннотации будет добавлена:

<p align="center">
<img src={require('/img/custom-annot/added_column.png').default} width="340"/>
</p>

Чтобы ***отредактировать колонку***, наведите на
неё курсор и нажмите на <img src={require('/img/custom-annot/edit_column.png').default} width="23"/>.

Чтобы ***удалить колонку***, наведите на на
неё курсор и нажмите на <img src={require('/img/custom-annot/delete_column.png').default} width="20"/>.

Таким же образом можно добавить несколько колонок аннотации.

### 5. Запуск процесса обработки {#perform-source-preparation}

Чтобы процесс обработки аннотации начался, нажмите 
на <img src={require('/img/custom-annot/start.png').default} width="200"/>.

:::caution Внимание!
Если вы пропустили один из обязательных шагов создания аннотации 
(загрузка файла, определение сборки референса файла, 
сопоставление колонок, необходимых для идентификации варианта, или добавление хотя бы одной колонки
для аннотаций, отличных от баз патогенности и COSMIC),
то кнопка <img src={require('/img/custom-annot/start_inactive.png').default} width="200"/> будет неактивна.
По файлу, не прошедшему обработку, аннотирование вариантов происходить не будет.
:::

Пока обработка аннотации находится ***в процессе***, статус будет "IN_PROGRESS":

<p align="center">
<img src={require('/img/custom-annot/annotation_in_progress.png').default} width="900"/>
</p>

***Успешно обработанная аннотация*** будет иметь статус "SUCCESS":

<p align="center">
<img src={require('/img/custom-annot/success_status.png').default} width="900"/>
</p>

или "PROBLEMS", если во время обработки возникли ***некритичные проблемы***
(подробнее о проблеме можно узнать ниже в разделе "Warnings"):

<p align="center">
<img src={require('/img/custom-annot/problems_status.png').default} width="900"/>
</p>

Обработка аннотации, подготовленной неправильно, ***завершится неудачно*** со статусом "FAILED"
(об источнике ошибки можно узнать ниже в разделе "Errors"):

<p align="center">
<img src={require('/img/custom-annot/failed_status.png').default} width="900"/>
</p>

В такой ситуации скорректируйте один из шагов подготовки аннотации (выберите верную сборку референса,
укажите правильный тип колонки аннотации) или выберите другой файл аннотации.

Чтобы вернуться к списку всех пользовательских аннотаций,
нажмите <img src={require('/img/custom-annot/back_btn.png').default} width="230"/>.

Значения колонок, выбранных для аннотации вариантов, будут 
находиться [на странице Variant Viewer](/results/main/snvs-indels/snv-details-panel#custom-annotation-sources-tab) и
в файле с вариантами, который можно скачать с главной страницы образца.

## Редактирование пользовательской аннотации {#edit-annotation}

- Если вы хотите отредактировать уже подготовленную аннотацию (добавить, удалить или отредактировать колонки аннотации,
поменять сборку рефересного генома или поменять выбор обязательных колонок), вы можете это сделать на её странице.
Для этого внесите необходимые изменения и нажмите <img src={require('/img/vv/apply.png').default} width="130"/>.
Чтобы отменить внесенные изменения, нажмите <img src={require('/img/rus/cancel_btn.png').default} width="110"/>
или просто покиньте страницу - изменения не сохранятся.

<p align="center">
<img src={require('/img/rus/apply_annot_changing.png').default} width="400"/>
</p>

- Если вы хотите прекратить определение уже подготовленной аннотации как базы патогенности или базы COSMIC,
выключите соответствующий переключатель на странице аннотации. Сохранять изменения в таком случае не нужно.

:::tip Совет
Если вы хотите, чтобы только что созданная или отредактированная аннотация аннотировала варианты образца, 
для которого уже завершена стадия "Аннотация SNVs/Indels", перезапустите процессинг образца или эту стадию.
:::

## Удаление пользовательской аннотации {#delete-annotation}

Чтобы удалить ненужную пользовательскую аннотацию, выполните следующие действия:

1. Наведите курсор на строку аннотации на странице "Пользовательские аннотации";

2. Нажмите на <img src={require('/img/rus/delete_btn.png').default} width="18"/>;

3. В появившемся окне подтвердите свои действия, нажав 
на <img src={require('/img/rus/delete.png').default} width="150"/>.

:::note На заметку
Данные удаленной аннотации сохранятся с пометкой "deleted" для вариантов, которые были аннотированы с её помощью 
до её удаления:

<p align="center">
<img src={require('/img/rus/deleted_custom.png').default} width="200"/>
</p>

:::
